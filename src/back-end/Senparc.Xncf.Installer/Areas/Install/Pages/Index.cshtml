@page
@model Senparc.Xncf.Instraller.Pages.IndexModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>NCF 安装 v @Senparc.Ncf.Core.Config.SiteConfig.VERSION</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--lib-->
    <script src="~/lib/vue/vue.js"></script>
    <script src="~/lib/element-ui_2.13.2/element.js"></script>
    <!--element-->
    <link href="~/lib/element-ui_2.13.2/element.css" rel="stylesheet" />
    <style>
        [v-cloak] {
            display: none;
        }

        #app {
            display: flex;
            justify-content: center;
            align-items: center;
            height:100%;
        }

        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        a {
            color: #535353;
            text-decoration-line: underline;
        }

        h2 {
            text-align: center;
            color: #09c821;
            margin: 30px 0px;
        }

        #footer {
            text-align: center;
            position: absolute;
            display: inline-block;
            width: 50%;
            bottom: 10%;
            /*margin: 240px 0px 50px 0px;*/
        }

        .logo {
            text-align: center;
            margin-bottom: 80px;
        }

            .logo img {
                width: 280px;
            }

        a.option_block {
            padding: 15px 20px;
            border: 1px solid #940b91;
            box-shadow: 0 0 15px #940b91;
            margin: 30px auto;
            clear: both;
            overflow: hidden;
            display: block;
            width: 200px;
            text-decoration: none;
        }

            a.option_block:hover {
                background: #610f6a;
                color: #ffffff;
            }

        .install_notice {
            margin: 20px auto;
            color: #808080;
            font-size: 80%;
        }

        .install_main {
            text-align: center;
            padding: 20px;
        }

        .btnOptions{

        }

        .vertical-line {
            border-left: 1px solid #D9D9D9;
            height: 400px;
            width: 30px;
        }


        .red {
            color: red;
        }
    </style>
</head>
<body>
    <div id="app">
        @switch (Model.Step)
        {
            case 0:
                <div class="install_main">
                    <div class="logo">
                        <img src="~/images/logo-login-ncf.png" />
                    </div>
                    <p class="install_notice">检测到系统未初始化，请进行安装！</p>
                    <p class="install_notice">当前数据库：@Model.MultipleDatabaseType</p>
                    <p class="install_notice">
                        多租户状态：@(Model.MultiTenantEnable ? "开启" : "关闭")
                        @if (Model.MultiTenantEnable)
                        {
                            <text>，规则：@Model.TenantRule</text>
                        }
                    </p>
                    <form method="post" @*action="/Install/Index"*@ id="install_form">
                        <a href="javascript:void(0);" onclick="return submit()" class="option_block" id="btnInstall">立即安装</a>
                        <p class="install_notice red">注意：安装完成后此页面将失效！</p>
                    </form>
                    <el-button type="text" v-on:click="toggleInfo" id="btnOptions">高级选项<i class="el-icon-arrow-right el-icon--right"></i></el-button>
                </div>
                <div class="vertical-line" v-if="isExpanded">
                </div>
                <div class="install_options" v-if="isExpanded">
                    <el-form label-width="140px" :label-position="labelPosition">
                        <el-form-item label="系统名称" required>
                            <el-input v-model="installOptions.systemName"></el-input>
                        </el-form-item>
                        <el-form-item label="管理员名称" required>
                            <el-input v-model="installOptions.adminUserName"></el-input>
                        </el-form-item>
                        <el-form-item label="数据库连接字符串" required>
                            <el-input type="textarea" v-model="installOptions.dbConnectionString"></el-input>
                        </el-form-item>
                    </el-form>
                </div>
                break;
            case 1:
                <h2>NeuCharFramework<br />初始化安装成功！</h2>
                <div>
                    @if (Model.MultiTenantEnable)
                    {
                        <p>
                            当前租户已创建，名称：<strong>@Model.TenantInfoDto.Name</strong>，
                            匹配规则：<strong>@Model.TenantRule</strong>，
                            关键匹配条件：<strong>@Model.TenantInfoDto.TenantKey</strong>
                        </p>
                    }
                    <p>&nbsp;</p>
                    <p>请保存好以下信息：</p>
                    <p>管理员账号：<strong>@Model.AdminUserName</strong></p>
                    <p>管理员密码：<strong>@Model.AdminPassword</strong></p>

                    <p>注意：本页面已经失效，请保存好管理员账号及密码，密码无法找回明文！</p>
                    <p class="center">&gt; <a @*asp-page="/Index" asp-area="Admin"*@ href="/Admin" target="_blank">点击这里登录管理员后台</a> &lt;</p>
                </div>
                break;
            default:
                break;
        }
        <div id="footer">
            苏州盛派网络科技有限公司 版权所有
        </div>
    </div>
    <script>
        var app = new Vue({
            el: '#app',
            data() {
                return {
                    labelPosition: 'left',
                    isExpanded: false,
                    installStarted: false,
                    installOptions:{
                        systemName: "Default",
                        adminUserName:"admin",
                        dbConnectionString:"123"
                    }
                }
            },
            methods: {
                toggleInfo() {
                    this.isExpanded = !this.isExpanded;
                },
                saveOptions(){
                },
                submit() {
                    if (installStarted) {
                        alert('安装已经在进行中，请等待');
                        return false;
                    }

                    if (!confirm('确定要开始安装吗？安装完成后此页面将失效！')) {
                        return false;
                    }

                    installStarted = true;

                    document.getElementById('install_form').submit();
                    document.getElementById('btnInstall').setAttribute('disabled', true);
                    document.getElementById('btnInstall').innerHTML = '安装已启动，请稍后……';

                    return true;
                }
            }
        })
    </script>
</body>
</html>

